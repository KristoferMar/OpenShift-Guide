# Creating a Helm Chart

Helm is an open source package manager for Kubernetes applications. It provides a way to package, share, and manage the life cycle of said Kubernetes applications.

The YAML files are 
- Chart.yaml: Holds the Chart definition information
- values.yaml: Holds the values that Helm uses in the default and user-created templates.

A Helm Chart is a collection of files and templates that define a Helm application. These files are later packaged for distribution using Helm repositories.

Make sure helm is installed
<pre>
[kristofermar@fedora]$ sudo dnf install helm
</pre>

The basic structure of the Chart.yaml looks like the following
<pre>
apiVersion: v2 
name: mychart 
description: A Helm chart for Kubernetes 
type: application 
version: 0.1.0 
appVersion: "1.0.0" 
</pre>

- Version of the Helm API to use
- Name of the Helm Chart
- Description of the Helm Chart
- Helm Chart Type: Application or Library
- Version of the Helm Chart
- Version of the application this Chart packages

The Chart.yaml file can hold other optional values, one of the most important values is the dependencies section. The dependencies section holds a list of other Helm Charts that allow this Helm Chart to work.

The structure of the dependencies section looks like this.
<pre>
dependencies: 
  - name: dependency1 
    version: 1.2.3
    repository: https://examplerepo.com/charts 
  - name: dependency2
    version: 3.2.1
    repository: https://helmrepo.example.com/charts
</pre>
 
- List of dependencies
- Name of the first required Helm Chart
- Chart version to depend on
- Repo holding the dependent Helm Chart

## Chart values
The most common practice is to provide the majority of the values by using the values.yaml file and to leave the dynamic ones only for values that you must provide at installation time.

The following is an excerpt from the contents of this file:
<pre>
...

image:
  repository: container.repo/name (1)
  pullPolicy: IfNotPresent (2)
  tag: "2.1" (3)

...

serviceAccount:
  create: true (4)
  annotations: {}
  name: "" (5)

...

service:
  type: ClusterIP (6)
  port: 80 (7)
</pre>

1. Link to the application's container image
2. Container pull policy in the Kubernetes cluster
3. Container tag to use, default value is the chart's appVersion
4. Create a service account for the application or not
5. Name of the service account, autogenerated if empty
6. Type of Kubernetes service
7. External application port

## Templates
Helm uses templates to create at runtime the resources needed to deploy the application in the Kubernetes cluster. The Helm CLI tool creates some of these templates, but you can modify them or create new ones to suit your needs.

<pre>
metadata:
  name: {{ include "mychart.fullname" . }} (1)
  labels:
    {{- include "mychart.labels" . | nindent 4 }}
spec:
  {{- if not .Values.autoscaling.enabled }} (2)
  replicas: {{ .Values.replicaCount }} (3)
  {{- end }} (4)
  template:
    spec:
      containers:
        - name: {{ .Chart.Name }} (5)
</pre>

1. The prefix for values from the Chart.yaml file is the name of the chart
2. Output the block if the value is false
3. The prefix for values from the values.yaml file is Values 
4. End the conditional block
5. The prefix for the name of the chart is Chart 
